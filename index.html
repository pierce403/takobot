<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#072133" />
    <link rel="canonical" href="https://tako.bot/" />
    <meta
      name="description"
      content="Tako is your highly autonomous and incredibly curious octopus friend built in Python with three internal systems: memory (git-tracked), emotion (deterministic DOSE), and productivity (GTD + PARA), grounded in web3-native XMTP and Ethereum rails."
    />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="takobot" />
    <meta property="og:title" content="takobot: your highly autonomous and incredibly curious octopus friend" />
    <meta
      property="og:description"
      content="Your highly autonomous and incredibly curious octopus friend with three systems: memory (git-tracked), emotion (deterministic DOSE), and productivity (GTD + PARA), plus Type 1/2 cognition and XMTP/Ethereum rails."
    />
    <meta property="og:url" content="https://tako.bot/" />
    <meta property="og:image" content="https://tako.bot/og-card.png" />
    <meta property="og:image:secure_url" content="https://tako.bot/og-card.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:image:alt"
      content="takobot social preview card with octopus mascot and key project highlights"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="takobot: your highly autonomous and incredibly curious octopus friend" />
    <meta
      name="twitter:description"
      content="Your highly autonomous and incredibly curious octopus friend with three systems: memory (git-tracked), emotion (deterministic DOSE), and productivity (GTD + PARA), plus Type 1/2 cognition and XMTP/Ethereum rails."
    />
    <meta name="twitter:image" content="https://tako.bot/og-card.png" />
    <meta
      name="twitter:image:alt"
      content="takobot social preview card with octopus mascot and key project highlights"
    />
    <title>takobot: your highly autonomous and incredibly curious octopus friend</title>
    <style>
      :root {
        color-scheme: dark;
        --bg0: #040d16;
        --bg1: #072133;
        --bg2: #0a3046;
        --card: rgba(255, 255, 255, 0.06);
        --card-2: rgba(255, 255, 255, 0.08);
        --border: rgba(255, 255, 255, 0.12);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.72);
        --muted-2: rgba(255, 255, 255, 0.56);
        --accent: #7c3aed;
        --accent-2: #22d3ee;
        --good: #34d399;
        --shadow: 0 18px 60px rgba(0, 0, 0, 0.45);
        --radius: 18px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        min-height: 100%;
      }

      html {
        background: var(--bg0);
      }

      body {
        min-height: 100vh;
        margin: 0;
        font: 16px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background: radial-gradient(1300px 720px at -8% -12%, rgba(34, 211, 238, 0.18), transparent 62%),
          radial-gradient(1100px 620px at 108% -10%, rgba(56, 189, 248, 0.16), transparent 60%),
          radial-gradient(1400px 760px at 50% 130%, rgba(14, 116, 144, 0.14), transparent 78%),
          linear-gradient(165deg, var(--bg2) 0%, var(--bg1) 44%, var(--bg0) 100%);
        background-repeat: no-repeat;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
        text-underline-offset: 0.2em;
      }

      code,
      pre {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
      }

      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        padding: 28px 20px 72px;
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        padding: 6px 0 22px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        letter-spacing: 0.2px;
      }

      .brand-badge {
        width: 34px;
        height: 34px;
        border-radius: 12px;
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.85), rgba(34, 211, 238, 0.65));
        box-shadow: 0 10px 25px rgba(124, 58, 237, 0.25);
        display: grid;
        place-items: center;
        border: 1px solid rgba(255, 255, 255, 0.14);
      }

      .brand-badge span {
        font-weight: 800;
        font-size: 16px;
      }

      .nav {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 10px 14px;
        border-radius: 14px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(10px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        text-decoration: none;
      }

      .btn:hover {
        background: rgba(255, 255, 255, 0.07);
        text-decoration: none;
      }

      .btn.primary {
        border-color: rgba(124, 58, 237, 0.5);
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.35), rgba(34, 211, 238, 0.18));
      }

      .hero {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 22px;
        align-items: stretch;
        padding: 18px 0 10px;
      }

      @media (max-width: 900px) {
        .hero {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
      }

      .hero-copy {
        padding: 22px 22px 18px;
        position: relative;
        overflow: hidden;
      }

      .hero-copy:before {
        content: "";
        position: absolute;
        inset: -1px;
        background: radial-gradient(600px 220px at 20% 0%, rgba(124, 58, 237, 0.22), transparent 55%);
        pointer-events: none;
      }

      .hero-copy > * {
        position: relative;
      }

      h1 {
        margin: 0 0 10px;
        font-size: clamp(34px, 3.8vw, 52px);
        line-height: 1.05;
        letter-spacing: -0.02em;
      }

      .subtitle {
        margin: 0 0 16px;
        color: var(--muted);
        font-size: 17px;
        max-width: 62ch;
      }

      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 14px 0 0;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(0, 0, 0, 0.14);
        color: var(--muted);
        font-size: 13px;
        white-space: nowrap;
      }

      .chip b {
        color: var(--text);
      }

      .tank {
        padding: 16px 16px 12px;
        display: grid;
        grid-template-rows: 1fr auto;
      }

      .tank-viewport {
        position: relative;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        overflow: hidden;
        background: radial-gradient(800px 380px at 40% 0%, rgba(34, 211, 238, 0.25), transparent 55%),
          linear-gradient(180deg, rgba(4, 20, 32, 0.9), rgba(6, 27, 44, 0.92));
        min-height: 280px;
      }

      .tank-viewport:before {
        content: "";
        position: absolute;
        inset: -2px;
        background: radial-gradient(700px 240px at 15% 15%, rgba(124, 58, 237, 0.22), transparent 58%);
        pointer-events: none;
      }

      .waves {
        position: absolute;
        left: -20%;
        right: -20%;
        bottom: -8px;
        height: 44px;
        opacity: 0.55;
        background: radial-gradient(24px 16px at 20px 18px, rgba(255, 255, 255, 0.22), transparent 65%),
          radial-gradient(26px 18px at 70px 24px, rgba(255, 255, 255, 0.18), transparent 65%),
          radial-gradient(24px 16px at 120px 18px, rgba(255, 255, 255, 0.22), transparent 65%);
        background-size: 140px 44px;
        animation: waveDrift 6.5s linear infinite;
        filter: blur(0.2px);
      }

      @keyframes waveDrift {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(140px);
        }
      }

      .octo-swim {
        position: absolute;
        top: 52%;
        left: 50%;
        width: min(380px, 82%);
        transform: translate(-50%, -50%);
        pointer-events: auto;
        cursor: pointer;
        touch-action: manipulation;
        transition: filter 0.16s ease;
        will-change: left, top, transform, filter;
      }

      .octo-swim:focus-visible {
        outline: 2px solid rgba(34, 211, 238, 0.85);
        outline-offset: 5px;
      }

      .octo-bob {
        animation: bob 2.8s ease-in-out infinite;
        will-change: transform;
      }

      @keyframes bob {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        50% {
          transform: translateY(-10px) rotate(-1deg);
        }
      }

      .tank-viewport.panic .octo-swim {
        filter: drop-shadow(0 8px 18px rgba(34, 211, 238, 0.45));
      }

      .tank-viewport.panic .octo-bob {
        animation-duration: 1.2s;
      }

      .tank-caption {
        margin: 10px 2px 0;
        color: var(--muted-2);
        font-size: 13px;
      }

      .section-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 18px;
        margin-top: 18px;
      }

      .system-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 18px;
        margin-top: 18px;
      }

      @media (max-width: 1050px) {
        .system-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      @media (max-width: 900px) {
        .section-grid {
          grid-template-columns: 1fr;
        }

        .system-grid {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        padding: 18px 18px 16px;
      }

      h2 {
        margin: 0 0 10px;
        font-size: 18px;
        letter-spacing: -0.01em;
      }

      p {
        margin: 10px 0;
        color: var(--muted);
      }

      ul {
        margin: 10px 0 0;
        padding-left: 18px;
        color: var(--muted);
      }

      li {
        margin: 7px 0;
      }

      pre {
        margin: 12px 0 0;
        padding: 14px 14px;
        border-radius: 14px;
        background: rgba(0, 0, 0, 0.26);
        border: 1px solid rgba(255, 255, 255, 0.12);
        overflow: auto;
      }

      .table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 10px;
        overflow: hidden;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(0, 0, 0, 0.14);
      }

      .table th,
      .table td {
        text-align: left;
        padding: 10px 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        vertical-align: top;
        font-size: 14px;
      }

      .table th {
        color: rgba(255, 255, 255, 0.86);
        font-weight: 700;
        background: rgba(255, 255, 255, 0.04);
      }

      .table tr:last-child td {
        border-bottom: 0;
      }

      footer {
        margin-top: 24px;
        padding-top: 18px;
        color: var(--muted-2);
        font-size: 13px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* SVG styling */
      .octo-svg {
        width: 100%;
        height: auto;
        display: block;
        overflow: visible;
      }

      .tentacle {
        transition: stroke-opacity 0.2s ease;
      }

      .bubble {
        transform-box: fill-box;
        transform-origin: center;
        opacity: 0;
        animation: bubbleRise 6.2s ease-in infinite;
      }

      .bubble.b2 {
        animation-delay: -1.1s;
      }
      .bubble.b3 {
        animation-delay: -2.2s;
      }
      .bubble.b4 {
        animation-delay: -3.4s;
      }
      .bubble.b5 {
        animation-delay: -4.7s;
      }

      @keyframes bubbleRise {
        0% {
          transform: translateY(26px) scale(0.9);
          opacity: 0;
        }
        10% {
          opacity: 0.6;
        }
        70% {
          opacity: 0.35;
        }
        100% {
          transform: translateY(-110px) scale(1.12);
          opacity: 0;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .waves,
        .octo-bob,
        .tentacle,
        .bubble {
          animation: none !important;
        }

        .octo-swim {
          top: 52%;
          left: 50%;
          transform: translate(-50%, -50%) !important;
          transition: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="brand" aria-label="takobot">
            <div class="brand-badge" aria-hidden="true"><span>üêô</span></div>
          <div>
            <div style="font-weight: 800; letter-spacing: -0.01em">takobot</div>
            <div style="color: var(--muted-2); font-size: 13px">your highly autonomous and incredibly curious octopus friend</div>
          </div>
        </div>
        <nav class="nav" aria-label="Links">
          <a class="btn primary" href="https://github.com/pierce403/takobot">View on GitHub</a>
          <a class="btn" href="#quickstart">Quickstart</a>
          <a class="btn" href="#features">Systems</a>
          <a class="btn" href="#config">Config</a>
        </nav>
      </header>

      <main>
          <section class="hero">
            <div class="card hero-copy">
              <h1>Your highly autonomous and incredibly curious octopus friend.</h1>
              <p class="subtitle">
                <b>takobot</b> is built in <b>Python</b> around three systems: a docs-first <b>memory system</b>, a
                deterministic <b>emotion system</b> (DOSE, D/O/S/E), and a <b>productivity system</b> (GTD + PARA),
                all under deliberate <b>Type 1 / Type 2</b> cognition. It can chat broadly, but only you can change its
                identity, tools, permissions, and routines.
                It is web3-native via <b>XMTP</b> and <b>Ethereum</b>, with <b>Farcaster</b> support on the roadmap.
              </p>
              <div class="chips" aria-label="Project highlights">
                <span class="chip"><b>Memory</b> system</span>
                <span class="chip"><b>Emotion</b> system (DOSE)</span>
                <span class="chip"><b>Productivity</b> system (GTD + PARA)</span>
                <span class="chip"><b>Type 1/2</b> cognition</span>
                <span class="chip"><b>You</b> control</span>
                <span class="chip"><b>Web3</b> XMTP + Ethereum</span>
                <span class="chip"><b>Farcaster</b> roadmap</span>
              </div>
            </div>

          <figure class="card tank">
            <div class="tank-viewport" aria-label="Animated octopus mascot">
              <div class="octo-swim" role="button" tabindex="0" aria-label="Poke Tako to make it swim around">
                <div class="octo-bob">
                  <svg
                    class="octo-svg"
                    viewBox="0 0 360 260"
                    xmlns="http://www.w3.org/2000/svg"
                    role="img"
                    aria-label="A cute animated octopus swimming"
                  >
                    <defs>
                      <linearGradient id="octoGrad" x1="0" x2="1" y1="0" y2="1">
                        <stop offset="0%" stop-color="#c4a4ff" />
                        <stop offset="55%" stop-color="#8b5cf6" />
                        <stop offset="100%" stop-color="#22d3ee" />
                      </linearGradient>
                      <filter id="softShadow" x="-30%" y="-30%" width="160%" height="160%">
                        <feDropShadow dx="0" dy="10" stdDeviation="12" flood-color="#000" flood-opacity="0.35" />
                      </filter>
                    </defs>

                    <!-- bubbles -->
                    <g fill="rgba(255,255,255,0.55)">
                      <circle class="bubble b1" cx="260" cy="190" r="5" />
                      <circle class="bubble b2" cx="290" cy="212" r="3.8" />
                      <circle class="bubble b3" cx="310" cy="196" r="4.4" />
                      <circle class="bubble b4" cx="236" cy="214" r="3.2" />
                      <circle class="bubble b5" cx="280" cy="232" r="2.8" />
                    </g>

                    <g filter="url(#softShadow)">
                      <!-- tentacles (stroke paths) -->
                      <g
                        fill="none"
                        stroke="url(#octoGrad)"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="16"
                        opacity="0.96"
                      >
                        <path class="tentacle t1" d="M125 150 C100 175, 96 205, 120 214 C145 224, 146 244, 116 246" />
                        <path class="tentacle t2" d="M145 154 C128 182, 130 210, 156 220 C182 230, 190 250, 160 252" />
                        <path class="tentacle t3" d="M165 156 C160 186, 168 212, 194 220 C220 228, 232 248, 204 252" />
                        <path class="tentacle t4" d="M188 156 C196 186, 214 210, 242 214 C270 218, 282 240, 256 250" />
                        <path class="tentacle t5" d="M115 142 C88 156, 72 176, 78 196 C84 216, 66 234, 46 226" />
                        <path class="tentacle t6" d="M205 146 C236 160, 256 178, 252 200 C248 222, 270 238, 292 232" />
                        <path class="tentacle t7" d="M135 144 C112 160, 102 176, 110 194 C118 212, 104 226, 90 218" />
                        <path class="tentacle t8" d="M210 148 C234 166, 246 184, 238 202 C230 220, 244 232, 258 224" />
                      </g>

                      <!-- body -->
                      <g>
                        <path
                          d="M180 44
                             C132 44, 96 80, 96 124
                             C96 154, 112 172, 132 176
                             C140 178, 148 178, 156 176
                             C166 174, 174 172, 180 172
                             C186 172, 194 174, 204 176
                             C212 178, 220 178, 228 176
                             C248 172, 264 154, 264 124
                             C264 80, 228 44, 180 44 Z"
                          fill="url(#octoGrad)"
                        />

                        <path
                          d="M124 92 C138 72, 162 60, 188 58 C210 56, 232 62, 246 76"
                          fill="none"
                          stroke="rgba(255,255,255,0.35)"
                          stroke-width="10"
                          stroke-linecap="round"
                          opacity="0.55"
                        />

                        <!-- face -->
                        <g>
                          <circle cx="156" cy="112" r="16" fill="rgba(255,255,255,0.95)" />
                          <circle cx="205" cy="112" r="16" fill="rgba(255,255,255,0.95)" />
                          <circle cx="161" cy="116" r="7.5" fill="rgba(6,19,32,0.9)" />
                          <circle cx="200" cy="116" r="7.5" fill="rgba(6,19,32,0.9)" />
                          <circle cx="164" cy="114" r="2.2" fill="rgba(255,255,255,0.85)" />
                          <circle cx="203" cy="114" r="2.2" fill="rgba(255,255,255,0.85)" />
                          <path
                            d="M168 136 C176 146, 184 146, 192 136"
                            fill="none"
                            stroke="rgba(6,19,32,0.75)"
                            stroke-width="6"
                            stroke-linecap="round"
                          />
                        </g>
                      </g>

                      <!-- little suckers -->
                      <g fill="rgba(255,255,255,0.22)">
                        <circle cx="126" cy="186" r="4" />
                        <circle cx="146" cy="196" r="3.6" />
                        <circle cx="170" cy="202" r="3.8" />
                        <circle cx="196" cy="202" r="3.8" />
                        <circle cx="220" cy="196" r="3.6" />
                        <circle cx="238" cy="186" r="4" />
                      </g>
                    </g>
                  </svg>
                </div>
              </div>
              <div class="waves" aria-hidden="true"></div>
            </div>
            <figcaption class="tank-caption">
              Tako („Åü„Åì) = octopus. Thus: a very serious mascot.
            </figcaption>
          </figure>
        </section>

        <section class="section-grid" id="quickstart">
          <div class="card panel">
            <h2>Quickstart</h2>
            <p>
              Bootstrap a new workspace in an empty directory (or an existing Tako workspace), then launch Tako's interactive terminal app:
            </p>
            <pre><code>mkdir tako-workspace
cd tako-workspace
curl -fsSL https://tako.bot/setup.sh | bash

# Next runs:
.venv/bin/takobot

# In app: hatchling onboarding asks name -> purpose -> XMTP handle?
# Startup: health check (instance + resources + lock)
# After onboarding: stage moves to child (world learning)
# Child chat starts with small context questions (who/where/what you do)
# Child can capture favorite websites into world_watch.sites automatically
# After pairing: XMTP adds remote control; terminal keeps full local operator control</code></pre>
            <p style="margin-top: 12px; color: var(--muted-2); font-size: 13px">
              Developer utilities: <code>.venv/bin/takobot doctor</code> and <code>.venv/bin/takobot hi --to &lt;to&gt; [--message ...]</code>.
            </p>
          </div>

          <div class="card panel">
            <h2>The three systems</h2>
            <ul>
              <li><b>Memory system</b>: durable knowledge in git-tracked Markdown (<code>memory/</code>) guided by repo-root <code>MEMORY.md</code> frontmatter spec.</li>
              <li><b>Emotion system</b>: deterministic DOSE state (<code>.tako/state/dose.json</code>) that biases escalation sensitivity and tone.</li>
              <li><b>Productivity system</b>: GTD + PARA execution structure (<code>tasks/</code>, <code>projects/</code>, <code>areas/</code>, <code>resources/</code>, <code>archives/</code>) plus open loops (<code>.tako/state/open_loops.json</code>).</li>
              <li><b>Life stages</b>: <code>hatchling</code> ‚Üí <code>child</code> ‚Üí <code>teen</code> ‚Üí <code>adult</code> with stage policies in <code>tako.toml</code>.</li>
              <li><b>Safety boundary</b>: operator control + quarantine-first skill/tool installs (analyze ‚Üí operator accept ‚Üí install enabled).</li>
            </ul>
            <p style="margin-top: 12px; color: var(--muted-2); font-size: 13px">
              Tako stays git-first: memory and productivity artifacts are reviewable; runtime state lives under <code>.tako/</code> and is never committed.
            </p>
          </div>
        </section>

          <section id="features">
            <div class="system-grid">
              <div class="card panel">
                <h2>Memory system</h2>
                <p>
                  A git-tracked second brain. The goal is reviewable durable knowledge, not runtime state.
                </p>
                <ul>
                  <li><b>Daily logs</b>: <code>memory/dailies/YYYY-MM-DD.md</code> (no secrets; summaries only).</li>
                  <li><b>World notes</b>: <code>memory/world/YYYY-MM-DD.md</code> + <code>memory/world/model.md</code>/<code>entities.md</code>/<code>assumptions.md</code>.</li>
                  <li><b>Reflections + contradictions</b>: <code>memory/reflections/</code> and <code>memory/contradictions/contradictions.md</code>.</li>
                  <li><b>Promotions</b>: operator-approved notes go into <code>MEMORY.md</code> (via <code>promote</code>).</li>
                  <li><b>Progressive summarization</b>: <code>compress</code> writes a structured summary block into today‚Äôs daily log.</li>
                </ul>
              </div>

              <div class="card panel">
                <h2>Emotion system</h2>
                <p>
                  A deterministic DOSE model (D/O/S/E) that reacts to events and decays toward baseline over time.
                </p>
                <ul>
                  <li><b>Runtime-only</b>: stored at <code>.tako/state/dose.json</code> (ignored by git).</li>
                  <li><b>Event-driven</b>: updated from the event log; ticked on heartbeat.</li>
                  <li><b>Visible</b>: numeric values + a small mode label (steady/curious/bonded/stressed) in the TUI.</li>
                  <li><b>Bias only</b>: shifts Type 1 ‚Üí Type 2 escalation sensitivity and lightweight planning hints; never overrides operator rules.</li>
                </ul>
              </div>

              <div class="card panel">
                <h2>Productivity system</h2>
                <p>
                  A committed execution structure (GTD + PARA) with outcomes, reviews, and an open-loops index.
                </p>
                <ul>
                  <li><b>PARA</b>: <code>projects/</code>, <code>areas/</code>, <code>resources/</code>, <code>archives/</code>.</li>
                  <li><b>Tasks</b>: one Markdown file per task under <code>tasks/</code> (YAML frontmatter, <code>open</code>/<code>done</code>/<code>blocked</code>/<code>someday</code>).</li>
                  <li><b>3 outcomes</b>: set with <code>morning</code>; stored in today‚Äôs daily log and tracked as open loops.</li>
                  <li><b>Weekly review</b>: <code>weekly</code> surfaces stale tasks + projects missing a next action.</li>
                  <li><b>Open loops index</b>: runtime-only <code>.tako/state/open_loops.json</code> shown in the sidebar.</li>
                </ul>
              </div>
            </div>

            <div class="card panel" style="margin-top: 18px">
              <h2>Feature tracker</h2>
              <p>
                This repo keeps a living <code>FEATURES.md</code> file (inspired by
                <a href="https://features.md">features.md</a>) so humans and agents can see what‚Äôs stable,
                in-progress, or planned.
              </p>
              <p style="margin-top: 12px">
                <a class="btn" href="https://github.com/pierce403/takobot/blob/main/FEATURES.md">Open FEATURES.md on GitHub</a>
                <a class="btn" href="https://github.com/pierce403/takobot/tree/main/docs" style="margin-left: 8px">Open docs/ on GitHub</a>
              </p>
            </div>
          </section>

          <section class="section-grid">
            <div class="card panel">
              <h2>What happens on first run</h2>
            <ul>
              <li>Creates a Python virtual environment in <code>.venv/</code>.</li>
              <li>Attempts to install or upgrade the engine with <code>pip install --upgrade takobot</code> (PyPI, including XMTP dependency). If that fails and no engine is present, it falls back to a source clone install.</li>
              <li>Materializes the workspace from engine templates (<code>takobot/templates/**</code>) without overwriting existing files (including local <code>tako.sh</code> launcher materialization), then initializes git on <code>main</code> if available.</li>
              <li>Ships a baseline model tuning reference at <code>resources/model-guide.md</code> for provider/model/thinking-level calibration.</li>
              <li>
                Generates <code>.tako/keys.json</code> with a wallet key and DB encryption key (unencrypted; file-perms only).
              </li>
              <li>Creates the local XMTP database in <code>.tako/xmtp-db/</code>.</li>
              <li>Creates runtime logs/temp dirs at <code>.tako/logs/</code> and <code>.tako/tmp/</code>.</li>
              <li>
                Initializes the memory system by ensuring today‚Äôs daily log exists at <code>memory/dailies/YYYY-MM-DD.md</code>.
              </li>
              <li>
                Runs a startup health check to classify environment state (brand-new vs established), verify lock/safety, and probe resources.
              </li>
              <li>
                Ensures required workspace-local <code>pi</code> runtime/auth is available, auto-syncs local Codex OAuth tokens into workspace pi auth when present, and writes inference metadata to <code>.tako/state/inference.json</code>.
              </li>
              <li>Loads auto-update policy from <code>tako.toml</code> (<code>[updates].auto_apply</code>, default <code>true</code>).</li>
              <li>Inference is pi-runtime-first and required; when pi is unavailable, Tako falls back to heuristic guidance instead of alternate model CLIs.</li>
              <li>Installs pi runtime by default under <code>.tako/pi/node</code>; if Node/npm are missing or system Node is below pi requirements (<code>&lt;20</code>), bootstraps workspace-local <code>nvm</code> under <code>.tako/nvm</code>.</li>
              <li>Keeps npm cache local to the workspace under <code>.tako/npm-cache</code> when installing Node tools.</li>
              <li>Supports direct inference configuration from commands: provider preference (<code>auto|pi</code>), persisted API keys, and pi OAuth inventory.</li>
              <li>Supports assisted pi login in-app: <code>inference login</code> relays prompts and accepts operator responses via <code>inference login answer &lt;text&gt;</code>; <code>inference login force</code> forces a fresh re-auth even when stale auth is detected as present.</li>
              <li>Workspace pi auth sync refreshes from newer local <code>~/.pi</code> auth profiles and does not overwrite an existing workspace <code>openai-codex</code> OAuth entry with Codex-imported tokens.</li>
              <li>When inference fails with OpenAI refresh-token errors, fallback replies include non-inference recovery steps (<code>inference login force</code>, <code>inference login answer &lt;text&gt;</code>, <code>inference refresh</code>, <code>inference auth</code>), and XMTP chat attempts auto-repair first.</li>
              <li>Pins inference subprocess temp output and <code>TMPDIR/TMP/TEMP</code> to <code>.tako/tmp/</code> (workspace-local only).</li>
              <li>Applies pi prompt guards before invocation: wraps oversized lines and trims over-budget prompts to avoid splitter chunk-limit failures.</li>
              <li>
                Keeps inference execution gated until the first interactive chat turn, so startup remains deterministic.
              </li>
              <li>
                Initializes the emotion system (DOSE) at <code>.tako/state/dose.json</code> and shows it live in the TUI.
              </li>
              <li>
                Uses a committed productivity system (GTD + PARA): <code>tasks/</code>, <code>projects/</code>, <code>areas/</code>, <code>resources/</code>, <code>archives/</code>.
              </li>
              <li>
                Launches the interactive terminal app and runs onboarding as explicit states (or falls back to stdout daemon mode when no interactive TTY is available).
              </li>
              <li>Uses stage policy from <code>tako.toml</code> (<code>[life].stage</code>) to control exploration cadence, Type2 budget/day, and DOSE baseline multipliers.</li>
              <li>
                Installs <code>tako.sh</code> with the package as a shell wrapper; deployed mode dispatches to installed <code>takobot</code>.
              </li>
              <li>
                Runs hatchling onboarding in order (name, purpose, XMTP handle), sends outbound pairing DM when applicable, and stores
                operator metadata in <code>.tako/operator.json</code> when paired.
              </li>
              <li>
                Offers a <code>morning</code> prompt to set 3 outcomes for today (stored in <code>memory/dailies/</code>).
              </li>
              <li>
                Starts a runtime service (heartbeat + exploration + sensors) with EventBus-backed Type 1 triage and Type 2 escalation for serious events.
              </li>
              <li>
                World Watch uses RSS/Atom feeds from <code>tako.toml</code> and, in <code>child</code> stage, randomly samples Reddit/Hacker News/Wikipedia; it writes deterministic notes (including mission-linked questions) to <code>memory/world/</code>, captures operator context in <code>memory/people/operator.md</code>, and adds operator-shared sites to <code>[world_watch].sites</code>.
              </li>
              <li>When runtime sits idle, boredom signals lower DOSE and trigger autonomous exploration sweeps (roughly hourly by default).</li>
              <li>When auto-updates are enabled, applies detected package updates and restarts the TUI automatically.</li>
              <li>On each heartbeat, auto-commits pending workspace changes and verifies no tracked changes remain.</li>
              <li>If git identity is missing, startup/heartbeat auto-configure repo-local identity from bot name (<code>&lt;name&gt; &lt;name.tako.eth@xmtp.mx&gt;</code>) and retry commit.</li>
              <li>If runtime health detects actionable problems, Tako auto-creates/reuses matching follow-up tasks under <code>tasks/</code>.</li>
              <li>Ensures a git-ignored <code>code/</code> directory exists for repo clones and code-work sandboxes.</li>
              <li>Seeds an OpenClaw-informed starter skill pack into <code>skills/</code>, registers those skills, and auto-enables installed extensions.</li>
              <li>If required setup is missing and auto-remediation fails (for example git identity), asks the operator in-app with concrete fix steps.</li>
              <li>Shows an animated mind indicator in the TUI while Tako is thinking/responding.</li>
              <li>If pi stream mode fails (for example unsupported stream-json or thinking flags), inference now auto-falls back to sync pi execution instead of failing the turn immediately.</li>
              <li>Uses XMTP typing indicators for outbound replies when supported by the installed XMTP SDK/runtime.</li>
              <li>On XMTP startup/rebuild/pairing/name updates, Tako verifies profile metadata against identity when read APIs are available, repairs mismatches when update APIs are available, and when writes are unavailable upserts Convos-compatible profile metadata in conversation <code>group.appData</code> (protobuf <code>ConversationCustomMetadata</code>) rather than sending chat-message JSON; deterministic avatar/cache files are written at <code>.tako/state/xmtp-avatar.svg</code>, <code>.tako/state/xmtp-profile.json</code>, and <code>.tako/state/xmtp-profile-broadcast.json</code>.</li>
              <li>Persists chat sessions in <code>.tako/state/conversations/</code> (<code>sessions.json</code> + per-session JSONL transcripts) and injects recent history into inference prompts.</li>
              <li>Checks DOSE-derived focus on every inference and runs <code>ragrep</code> semantic recall over <code>memory/</code> with adaptive breadth (focused: minimal context, diffuse: broader context) using runtime-local index state in <code>.tako/state/ragrep-memory.db</code>.</li>
              <li>
                Maintains an open-loops index at <code>.tako/state/open_loops.json</code> (unfinished tasks + onboarding prompts) and shows it in the sidebar.
              </li>
              <li>
                Shows a live activity panel (inference/tool/runtime) plus a top-right stage-specific ASCII octopus panel with Takobot version and compact DOSE indicators.
              </li>
            </ul>
          </div>

          <div class="card panel" id="config">
            <h2>Control plane</h2>
            <p>
              Operator control is available in the terminal app and over the paired XMTP channel.
              There is no user-facing configuration via environment variables or CLI flags.
            </p>
            <ul>
              <li>Before pairing: terminal app is primary onboarding/control loop.</li>
              <li>After pairing: XMTP provides remote control for identity/config/tools/routines, while terminal keeps full local operator control.</li>
              <li>
                After pairing, operator commands include:
                <code>help</code>, <code>status</code>, <code>doctor</code>,
                <code>config</code>,
                <code>jobs</code>,
                <code>task</code>/<code>tasks</code>/<code>done</code>,
                <code>morning</code>/<code>outcomes</code>/<code>compress</code>/<code>weekly</code>/<code>promote</code>,
                <code>update</code>, <code>web</code>, <code>run</code>, <code>exec</code>, <code>reimprint</code>.
              </li>
              <li><code>jobs</code> supports natural-language schedules (for example <code>every day at 3pm run doctor</code>) and persists schedules under <code>.tako/state/cron/jobs.json</code>.</li>
              <li>When `update` is applied over XMTP in paired TUI mode, Tako requests terminal restart automatically after sending the update result.</li>
              <li><code>run</code>/<code>exec</code> command execution uses <code>code/</code> as working directory (git-ignored).</li>
              <li><code>workspace.name</code> in <code>tako.toml</code> is treated as Tako‚Äôs identity name and syncs with rename flows.</li>
              <li>Identity rename handling is inference-classified instead of phrase-gated; if no replacement name is provided, Tako asks for the exact target name.</li>
              <li>Use <code>config</code> to get an inline explanation of current <code>tako.toml</code> options/values.</li>
              <li><code>doctor</code> auto-runs inference repair first (workspace pi runtime/auth), then runs offline diagnostics (provider CLI probes + recent inference error scan) without needing inference.</li>
              <li>Starter skills include OpenClaw top-download capabilities, prioritized <code>skill-creator</code> + <code>tool-creator</code> + <code>mcporter-mcp</code>, and an <code>agent-cli-inferencing</code> guide that nudges toward <code>@mariozechner/pi-ai</code>.</li>
              <li>Pi chat inference runs with tools/skills/extensions enabled and can use workspace <code>skills/</code> + <code>tools/</code> directly.</li>
              <li>Workspace ships standard web tool names under <code>tools/</code>: <code>web_search</code> (discovery) and <code>web_fetch</code> (source extraction, optional Playwright rendering).</li>
              <li>Plain-text XMTP messages are treated as chat (inference-backed when available); command-style messages route to command handlers.</li>
              <li>Terminal remains a local cockpit for status/logs/safe mode, plain-text chat, and local operator configuration commands.</li>
              <li>TUI clipboard helpers: <code>Ctrl+Shift+C</code> copies transcript, <code>Ctrl+Shift+L</code> copies last line.</li>
              <li>TUI input supports history recall: <code>‚Üë</code>/<code>‚Üì</code> cycles previously submitted local messages.</li>
              <li>TUI slash shortcuts: type <code>/</code> to open a command dropdown under the input field, including <code>/models</code>, <code>/jobs</code>, <code>/stats</code>, <code>/upgrade</code>, and <code>/dose &lt;channel&gt; &lt;0..1&gt;</code>.</li>
              <li>TUI command input supports <code>Tab</code> autocomplete for command names and cycles matching candidates on repeated <code>Tab</code>.</li>
              <li>Local TUI input is queued so long-running turns do not block new entry; pending input count is visible in status and sensors.</li>
              <li>Outbound XMTP replies are mirrored into the local TUI transcript/activity feed for a unified conversation view.</li>
              <li>Mission objectives are formalized in <code>SOUL.md</code> (<code>## Mission Objectives</code>) and editable in-app via <code>mission show|set|add|clear</code>.</li>
              <li>Bubble stream now shows the active request focus and elapsed thinking/responding time for long responses.</li>
              <li>Prompt context stack parity: local TUI and XMTP chat both include <code>SOUL.md</code>/<code>SKILLS.md</code>/<code>TOOLS.md</code> excerpts, live capability inventories, <code>MEMORY.md</code> frontmatter, focus summary, semantic RAG context, and recent conversation history.</li>
              <li>Child-stage chat is less interrogative: it answers first, avoids asking which channel is in use, and applies profile-aware anti-repeat guidance for follow-up questions.</li>
              <li>Incremental <code>pi thinking</code> stream chunks are coalesced into one inline thinking line (instead of newline-per-token), while structural markers stay separate.</li>
              <li>During streamed inference, tool/research progress is surfaced as live "active work" in the Tasks panel (for example browsing/search/tool steps).</li>
              <li>TUI right-click on selected transcript/stream text copies that selection in-app without clearing it.</li>
              <li>XMTP runtime is more resilient: transient send errors are retried and repeated poll/stream failures trigger client-session rebuilds.</li>
              <li>Inference stream emits periodic debug wait updates and applies a total local-chat timeout budget to avoid indefinite response stalls.</li>
              <li>Pi chat logs include turn summaries in <code>.tako/logs/runtime.log</code> and <code>.tako/logs/app.log</code> (<code>pi chat user</code>/<code>pi chat assistant</code>).</li>
              <li>Even unexpected provider exceptions (outside normal subprocess exits) are appended to <code>.tako/logs/error.log</code> with traceback context.</li>
              <li>Local/XMTP chat prompts enforce canonical identity naming from workspace config/identity state after rename updates.</li>
              <li>Runtime state lives under <code>.tako/</code> and is never committed.</li>
            </ul>
            <p style="margin-top: 12px; color: var(--muted-2); font-size: 13px">
              Note: treat <code>.tako/keys.json</code> as sensitive (and never commit anything under <code>.tako/</code>).
            </p>
          </div>
        </section>

        <section class="section-grid">
          <div class="card panel">
            <h2>Operational notes</h2>
            <ul>
              <li>
                XMTP requires outbound network access; if messaging fails, double-check your HTTPS /
                HTTP2 egress.
              </li>
              <li>
                Runtime cognition consumes <code>.tako/state/events.jsonl</code> with Type 1 triage and escalates critical signals to Type 2 depth tasks.
              </li>
              <li>
                Type 2 uses the required pi runtime for model reasoning; if pi is unavailable/fails, Tako falls back to heuristic safety recommendations.
              </li>
              <li>
                Before the first interactive turn, Type 2 remains heuristic-only by design.
              </li>
              <li>
                The daemon retries XMTP stream subscriptions with backoff and falls back to polling when stream errors persist.
              </li>
              <li>
                XMTP client initialization disables history sync by default for compatibility.
              </li>
              <li>
                Workspace bootstrap is <code>venv + pip</code>. No <code>uv</code> required.
              </li>
              <li>
                If you see DB errors (e.g., ‚Äúfile is not a database‚Äù), delete <code>.tako/xmtp-db</code>
                (or delete <code>.tako/</code>) to force a clean rebuild.
              </li>
              <li>
                ENS resolution tries configured RPC endpoints first and may fall back to a public
                resolver if needed.
              </li>
            </ul>
          </div>

          <div class="card panel">
            <h2>Links</h2>
            <ul>
              <li>
                GitHub:
                <a href="https://github.com/pierce403/takobot">github.com/pierce403/takobot</a>
              </li>
              <li>
                Docs:
                <a href="https://github.com/pierce403/takobot/blob/main/AGENTS.md">AGENTS</a>,
                <a href="https://github.com/pierce403/takobot/blob/main/SOUL.md">SOUL</a>,
                <a href="https://github.com/pierce403/takobot/blob/main/VISION.md">VISION</a>,
                <a href="https://github.com/pierce403/takobot/blob/main/MEMORY.md">MEMORY</a>,
                <a href="https://github.com/pierce403/takobot/blob/main/SKILLS.md">SKILLS</a>,
                <a href="https://github.com/pierce403/takobot/blob/main/TOOLS.md">TOOLS</a>,
                <a href="https://github.com/pierce403/takobot/blob/main/ONBOARDING.md">ONBOARDING</a>
              </li>
              <li>
                Features:
                <a href="https://github.com/pierce403/takobot/blob/main/FEATURES.md">FEATURES.md</a>
              </li>
              <li>
                Entrypoint:
                <code>setup.sh</code> then <code>.venv/bin/takobot</code>
              </li>
              <li>
                CLI:
                <code>.venv/bin/takobot</code> or <code>python -m takobot</code>
              </li>
            </ul>
            <p style="margin-top: 12px">
              Want this page hosted? Enable GitHub Pages and point it at the branch/folder that
              contains <code>index.html</code>.
            </p>
          </div>
        </section>
      </main>

      <footer>
        Built to be safe, you-controlled, and git-first. If it breaks, add a note in <code>AGENTS.md</code>
        (and a short entry in <code>memory/dailies/</code>) so future-us suffers less.
      </footer>
    </div>
    <script>
      (() => {
        const viewport = document.querySelector(".tank-viewport");
        const octo = viewport?.querySelector(".octo-swim");
        if (!viewport || !octo) return;

        const motionQuery = window.matchMedia("(prefers-reduced-motion: reduce)");
        let reduceMotion = motionQuery.matches;
        let panicTimer = 0;

        const TENTACLE_MODEL = [
          { id: "t1", anchor: [125, 150], mid: [120, 214], tip: [116, 246], side: -1, amp: 8.8, phase: 0.14, freq: 3.1, turn: 3.2 },
          { id: "t2", anchor: [145, 154], mid: [156, 220], tip: [160, 252], side: -1, amp: 7.8, phase: 0.66, freq: 2.8, turn: 2.2 },
          { id: "t3", anchor: [165, 156], mid: [194, 220], tip: [204, 252], side: -1, amp: 7.2, phase: 1.05, freq: 2.55, turn: 1.2 },
          { id: "t4", anchor: [188, 156], mid: [242, 214], tip: [256, 250], side: 1, amp: 8.4, phase: 1.46, freq: 2.5, turn: -1.5 },
          { id: "t5", anchor: [115, 142], mid: [78, 196], tip: [46, 226], side: -1, amp: 11.2, phase: 0.38, freq: 3.3, turn: 4.3 },
          { id: "t6", anchor: [205, 146], mid: [252, 200], tip: [292, 232], side: 1, amp: 11.0, phase: 1.86, freq: 3.26, turn: -4.1 },
          { id: "t7", anchor: [135, 144], mid: [110, 194], tip: [90, 218], side: -1, amp: 8.4, phase: 0.92, freq: 2.98, turn: 2.8 },
          { id: "t8", anchor: [210, 148], mid: [238, 202], tip: [258, 224], side: 1, amp: 8.3, phase: 2.2, freq: 2.95, turn: -2.7 },
        ];

        const tentacles = TENTACLE_MODEL.map((model) => {
          const path = viewport.querySelector(`.tentacle.${model.id}`);
          if (!path) return null;
          const [ax, ay] = model.anchor;
          const [mx, my] = model.mid;
          const [tx, ty] = model.tip;
          const dx = tx - ax;
          const dy = ty - ay;
          const len = Math.hypot(dx, dy) || 1;
          const ux = dx / len;
          const uy = dy / len;
          const nx = -uy * model.side;
          const ny = ux * model.side;
          return {
            path,
            baseD: path.getAttribute("d") || "",
            ax,
            ay,
            mx,
            my,
            tx,
            ty,
            len,
            ux,
            uy,
            nx,
            ny,
            amp: model.amp,
            phase: model.phase,
            freq: model.freq,
            turn: model.turn,
          };
        }).filter(Boolean);

        if (!tentacles.length) return;

        const state = {
          x: 0,
          y: 0,
          vx: 0,
          vy: 0,
          targetX: 0,
          targetY: 0,
          flip: 1,
          panicUntil: 0,
          lastFrame: 0,
        };

        function clamp(value, min, max) {
          return Math.min(max, Math.max(min, value));
        }

        function random(min, max) {
          return min + Math.random() * (max - min);
        }

        function num(value) {
          return Number(value.toFixed(2));
        }

        function resetTentacles() {
          for (const tentacle of tentacles) {
            tentacle.path.setAttribute("d", tentacle.baseD);
          }
        }

        function updateTentacles(now, speed, panic) {
          if (reduceMotion) return;

          const time = now * 0.001;
          const speedFactor = clamp(speed / 190, 0, 1);
          const panicFactor = panic ? 1.35 : 1;
          const drift = clamp(state.vx / 170, -1, 1);

          for (const tentacle of tentacles) {
            const phase = time * tentacle.freq + tentacle.phase;
            const oscillation = Math.sin(phase) + Math.sin(phase * 1.9 + tentacle.phase * 1.7) * 0.33;
            const amp = tentacle.amp * (0.78 + speedFactor * 0.88) * panicFactor;
            const bend = oscillation * amp + drift * tentacle.turn;
            const tipCurl = bend * 1.24 + Math.sin(phase - 0.82) * amp * 0.42;

            const p0x = tentacle.ax;
            const p0y = tentacle.ay;
            const p1x = tentacle.ax + (tentacle.mx - tentacle.ax) * 0.4 + tentacle.nx * bend * 0.34;
            const p1y = tentacle.ay + (tentacle.my - tentacle.ay) * 0.4 + tentacle.ny * bend * 0.34;
            const p2x = tentacle.mx + tentacle.nx * bend;
            const p2y = tentacle.my + tentacle.ny * bend;
            const tipPush = 1.5 + speedFactor * 2.8 + (panic ? 2.4 : 0);
            const p3x = tentacle.tx + tentacle.nx * tipCurl + tentacle.ux * tipPush;
            const p3y = tentacle.ty + tentacle.ny * tipCurl + tentacle.uy * tipPush;

            const c1x = p0x + tentacle.ux * (tentacle.len * 0.22) + tentacle.nx * bend * 0.18;
            const c1y = p0y + tentacle.uy * (tentacle.len * 0.22) + tentacle.ny * bend * 0.18;
            const c2x = p1x + tentacle.ux * (tentacle.len * 0.2) + tentacle.nx * bend * 0.52;
            const c2y = p1y + tentacle.uy * (tentacle.len * 0.2) + tentacle.ny * bend * 0.52;
            const c3x = p2x + tentacle.ux * (tentacle.len * 0.18) + tentacle.nx * bend * 0.64;
            const c3y = p2y + tentacle.uy * (tentacle.len * 0.18) + tentacle.ny * bend * 0.64;
            const c4x = p3x - tentacle.ux * (tentacle.len * 0.2) + tentacle.nx * bend * 0.2;
            const c4y = p3y - tentacle.uy * (tentacle.len * 0.2) + tentacle.ny * bend * 0.2;

            tentacle.path.setAttribute(
              "d",
              `M${num(p0x)} ${num(p0y)} C${num(c1x)} ${num(c1y)}, ${num(c2x)} ${num(c2y)}, ${num(p2x)} ${num(p2y)} C${num(c3x)} ${num(c3y)}, ${num(c4x)} ${num(c4y)}, ${num(p3x)} ${num(p3y)}`
            );
          }
        }

        function limits() {
          const tank = viewport.getBoundingClientRect();
          const body = octo.getBoundingClientRect();
          const padX = Math.min(24, tank.width * 0.05);
          const padY = Math.min(22, tank.height * 0.06);
          return {
            minX: body.width / 2 + padX,
            maxX: tank.width - body.width / 2 - padX,
            minY: body.height / 2 + padY,
            maxY: tank.height - body.height / 2 - padY,
          };
        }

        function render(tilt) {
          octo.style.left = `${state.x}px`;
          octo.style.top = `${state.y}px`;
          octo.style.transform = `translate(-50%, -50%) scaleX(${state.flip}) rotate(${tilt.toFixed(2)}deg)`;
        }

        function pickTarget() {
          const lim = limits();
          state.targetX = random(lim.minX, lim.maxX);
          state.targetY = random(lim.minY, lim.maxY);
        }

        function panicBurst(clientX, clientY) {
          if (reduceMotion) return;
          const tank = viewport.getBoundingClientRect();
          const px = clientX - tank.left;
          const py = clientY - tank.top;
          const dx = state.x - px;
          const dy = state.y - py;
          const dist = Math.hypot(dx, dy) || 1;
          const impulse = 240 + Math.random() * 140;
          state.vx += (dx / dist) * impulse;
          state.vy += (dy / dist) * impulse;
          state.panicUntil = performance.now() + 2200;
          viewport.classList.add("panic");
          window.clearTimeout(panicTimer);
          panicTimer = window.setTimeout(() => viewport.classList.remove("panic"), 2300);
          pickTarget();
        }

        octo.addEventListener("pointerdown", (event) => {
          event.preventDefault();
          panicBurst(event.clientX, event.clientY);
        });

        octo.addEventListener("keydown", (event) => {
          if (event.key !== "Enter" && event.key !== " ") return;
          event.preventDefault();
          const rect = octo.getBoundingClientRect();
          panicBurst(rect.left + rect.width / 2, rect.top + rect.height / 2);
        });

        function tick(now) {
          if (!state.lastFrame) state.lastFrame = now;
          const dt = Math.min(0.05, (now - state.lastFrame) / 1000);
          state.lastFrame = now;
          let panic = now < state.panicUntil;
          let speed = Math.hypot(state.vx, state.vy);

          if (!reduceMotion) {
            const lim = limits();
            const pull = panic ? 0.92 : 0.5;
            state.vx += (state.targetX - state.x) * pull * dt;
            state.vy += (state.targetY - state.y) * pull * dt;

            const drag = panic ? 0.992 : 0.978;
            const damp = Math.pow(drag, dt * 60);
            state.vx *= damp;
            state.vy *= damp;

            const maxSpeed = panic ? 360 : 155;
            speed = Math.hypot(state.vx, state.vy);
            if (speed > maxSpeed) {
              const ratio = maxSpeed / speed;
              state.vx *= ratio;
              state.vy *= ratio;
              speed = maxSpeed;
            }

            state.x += state.vx * dt;
            state.y += state.vy * dt;

            if (state.x < lim.minX) {
              state.x = lim.minX;
              state.vx = Math.abs(state.vx) * 0.7;
            } else if (state.x > lim.maxX) {
              state.x = lim.maxX;
              state.vx = -Math.abs(state.vx) * 0.7;
            }

            if (state.y < lim.minY) {
              state.y = lim.minY;
              state.vy = Math.abs(state.vy) * 0.7;
            } else if (state.y > lim.maxY) {
              state.y = lim.maxY;
              state.vy = -Math.abs(state.vy) * 0.7;
            }

            if (Math.abs(state.vx) > 8) {
              state.flip = state.vx >= 0 ? 1 : -1;
            }

            const closeToTarget = Math.hypot(state.targetX - state.x, state.targetY - state.y) < 26;
            if (closeToTarget || Math.random() < (panic ? 0.002 : 0.0008)) {
              pickTarget();
            }
          } else {
            panic = false;
            speed = 0;
          }

          const tilt = clamp(state.vx * 0.035 + state.vy * 0.02, -10, 10);
          updateTentacles(now, speed, panic);
          render(tilt);
          requestAnimationFrame(tick);
        }

        function initPosition() {
          const tank = viewport.getBoundingClientRect();
          const body = octo.getBoundingClientRect();
          state.x = body.left - tank.left + body.width / 2;
          state.y = body.top - tank.top + body.height / 2;
          const lim = limits();
          state.x = clamp(state.x, lim.minX, lim.maxX);
          state.y = clamp(state.y, lim.minY, lim.maxY);
          pickTarget();
          if (reduceMotion) {
            resetTentacles();
          } else {
            updateTentacles(performance.now(), 0, false);
          }
          render(0);
        }

        function onResize() {
          const lim = limits();
          state.x = clamp(state.x, lim.minX, lim.maxX);
          state.y = clamp(state.y, lim.minY, lim.maxY);
          pickTarget();
          if (reduceMotion) {
            resetTentacles();
          }
          render(0);
        }

        if (typeof motionQuery.addEventListener === "function") {
          motionQuery.addEventListener("change", (event) => {
            reduceMotion = event.matches;
            if (reduceMotion) {
              viewport.classList.remove("panic");
              state.vx = 0;
              state.vy = 0;
              resetTentacles();
            } else {
              pickTarget();
            }
          });
        }

        window.addEventListener("resize", onResize);

        requestAnimationFrame(() => {
          initPosition();
          requestAnimationFrame(tick);
        });
      })();
    </script>
  </body>
</html>
